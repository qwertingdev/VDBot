"use strict";function _defineProperty(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function _toConsumableArray(t){return _arrayWithoutHoles(t)||_iterableToArray(t)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function _iterableToArray(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}function _arrayWithoutHoles(t){if(Array.isArray(t)){for(var e=0,n=new Array(t.length);e<t.length;e++)n[e]=t[e];return n}}function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function setHistoryState(t){var e=t.toString()||"";window.history.pushState({},"","?".concat(e)),"undefined"!=typeof VK&&VK._inited&&VK.callMethod("setLocation","loc=".concat(window.location.pathname).concat(window.location.search))}function addOnClickHandler(t,e,n){var a=(n||document).getElementsByClassName(t);Array.prototype.forEach.call(a,e)}function getParent(t,e){return t.classList&&t.classList.contains(e)?t:t.parentElement?getParent(t.parentElement,e):null}function sklonen(t,e,n,a){var o=t%10,i=t%100;return 0==o||5<=o||10<=i&&i<=20?a:2<=o&&o<=4?n:e}function reverse(t){return t.split("").reverse().join("")}function removePrecedingZeros(t){var e=t.length-1,n=reverse(t[e]);return t[e]=reverse(parseInt(n,10).toString()),t}function extractNumberParts(t,e){for(var n,a,o,i=t.split("").reverse(),r=[],s=0,c=Math.ceil(t.length/e);s<c;s++){for(n="",o=0;o<e&&(a=s*e+o)!==t.length;o++)n+=i[a];r.push(n)}return r}function getSeparatedNumber(t){var e=t.toString();3<e.length&&(e=reverse(e=removePrecedingZeros(extractNumberParts(e,3)).join(" ")));return e}function getNiceSeparatedNumber(t){return t<1e3?t%1==0?Number(t):Number(t).toFixed(2):t%1==0?getSeparatedNumber(Number(t)):getSeparatedNumber(Math.trunc(t))+"."+Number(t).toFixed(2).split(".")[1]}function wrapDomElement(t){if(!t.tagName)return t.data;var e={tag:t.tagName.toLowerCase()};if(t.attributes.length){e.attrs={};for(var n=0;n<t.attributes.length;n++){var a=t.attributes[n];e.attrs[a.name]=a.value}}if(t.childNodes.length){e.children=[];for(var o=0;o<t.childNodes.length;o++)e.children.push(wrapDomElement(t.childNodes[o]))}return e}function selectElem(t){var e=document.createRange();e.selectNodeContents(t);var n=window.getSelection();n.removeAllRanges(),n.addRange(e)}function getJSON(t,e,n){var a="";return"function"==typeof e?n=e:a=getParamsStr(e),fetch(t+a,{headers:{"X-CSRF-TOKEN":getJSON.CSRF,"X-Requested-With":"XMLHttpRequest"},credentials:"same-origin"}).then(checkStatus).then(function(t){return t.json()}).then(n).catch(function(t){console.log("parsing failed",t)})}function getText(t,e,n){var a="";return"function"==typeof e?n=e:a=getParamsStr(e),fetch(t+a,{headers:{"X-CSRF-TOKEN":getJSON.CSRF,"X-Requested-With":"XMLHttpRequest"},credentials:"same-origin"}).then(checkStatus).then(function(t){return t.text()}).then(n)}function getParamsStr(n){return Object.keys(n).reduce(function(t,e){return"?"!==t&&(t+="&"),"".concat(t+e,"=").concat(n[e])},"?")}function getContentFromElements(t){var n="";return"string"==typeof t?t:(t.forEach(function(t){if(t.children)for(var e=0;e<t.children.length;e++)n+=getContentFromElements(t.children[e]);else"string"==typeof t?n+=t:"IMG"===t.tag&&(n+=t.attrs.alt)}),n)}function triggerEvent(t,e){if("createEvent"in document){var n=document.createEvent("HTMLEvents");n.initEvent(e,!1,!0),t.dispatchEvent(n)}else{var a=document.createEventObject();a.eventType=e,t.fireEvent("on".concat(a.eventType),a)}}function live(t,o,i,r){document.addEventListener(t,function(t){var e=(r||document).querySelectorAll(o);if(e){for(var n,a=t.target;a&&-1===(n=Array.prototype.indexOf.call(e,a));)a=a.parentElement;-1<n&&i.call(a,t)}})}function getBots(t,e){getJSON("/ajax/get/bots",{ignore:e||!0},t)}function isURL(t){return new RegExp("^(https?:\\/\\/)?((([a-z\\d]([a-z\\d-]*[a-z\\d])*)\\.?)+[a-z]{2,}|((\\d{1,3}\\.){3}\\d{1,3}))(\\:\\d+)?(\\/[-a-z\\d%_.~+]*)*(\\?[;&a-z\\d%_.~+=-]*)?(\\#[-a-z\\d_]*)?$","i").test(t)}function getVkUserByUrl(){var t=this.value.trim(),n=this;setTimeout(function(){n.value=""},500),t.match(/^(https?:\/\/)?vk\.com\/[a-z\d_.]+$/)&&getJSON("/ajax/get/profile/vk",{url:t},function(e){if(e.error)e.message&&alertify.error(e.message);else{var t=n.parentNode;try{Array.prototype.forEach.call(t.parentNode.children,function(t){if(t.getAttribute("data-id")==e.id)throw Error()}),t.insertAdjacentHTML("beforebegin",'<div class="ui-users-list__item js-user" data-id="'.concat(e.id,'"><a href="https://vk.com/id').concat(e.id,'" target="_blank">').concat(e.first_name," ").concat(e.last_name,'</a><button class="cross-btn js-remove-user"></button></div>')),VkUsersHistory().add(e.id,"".concat(e.first_name," ").concat(e.last_name))}catch(t){}}})}function VkUsersHistory(){var e;function o(){if(!e){var t=document.getElementById("current-bot").getAttribute("data-id");e=store.get("vk_users_links_history-".concat(t))||[]}return e}function i(t){for(var e=o(),n=0;n<e.length;n++)if(e[n].id==t)return n;return!1}function r(t){var e=document.getElementById("current-bot").getAttribute("data-id");store.set("vk_users_links_history-".concat(e),t)}return{add:function(t,e){var n=o(),a=i(t);e=e.substr(0,50),!1!==a?(n.splice(0,0,n.splice(a,1)[0]),n[0].name=e):n.unshift({id:t,name:e}),6<n.length&&n.pop(),r(n)},remove:function(t){var e=o(),n=i(t);e.splice(n,1),r(e)},addTooltip:function(t){var e=o();if(e.length){var n='<div class="ui-users-list__tooltip"><ul>';e.forEach(function(t){n+='<li data-user-id="'.concat(t.id,'">').concat(t.name,'<button class="cross-btn js-remove-user"></button></li>')}),n+="</ul></div>",t.insertAdjacentHTML("afterend",n),t.nextElementSibling.addEventListener("click",function(t){var e=t.target,n=this.parentNode;if("LI"===e.tagName){var a=e.getAttribute("data-user-id");n.parentNode.parentNode.querySelector('[data-id="'.concat(a,'"]'))?alertify.error("Пользователь уже добавлен"):n.insertAdjacentHTML("beforebegin",'<div class="ui-users-list__item js-user" data-id="'.concat(a,'"><a href="https://vk.com/id').concat(a,'" target="_blank">').concat(e.textContent,'</a><button class="cross-btn js-remove-user"></button></div>'))}else if("BUTTON"===e.tagName){var o=e.parentNode.getAttribute("data-user-id");VkUsersHistory().remove(o)}})}}}}function vkProfileLinkInput(t){t.addEventListener("input",getVkUserByUrl),t.addEventListener("paste",getVkUserByUrl),t.parentNode.parentNode.addEventListener("click",function(t){var e=t.target;e.classList.contains("js-remove-user")&&e.parentNode.parentNode.removeChild(e.parentNode)}),VkUsersHistory().addTooltip(t)}function checkStatus(t){if(200<=t.status&&t.status<300)return t;var e=new Error(t.statusText);throw e.response=t,e}function toggleButtonText(t,e){this.classList.toggle("js-selected");var n=this.parentNode.getElementsByClassName("js-selected").length,a=t.getAttribute("data-text");0<n?(1===n&&this.classList.contains("js-selected")&&(t.setAttribute("data-text",e.textContent),e.textContent=a),e.nextElementSibling.textContent="(".concat(n,")"),t.classList.remove("disabled")):(t.setAttribute("data-text",e.textContent),e.textContent=a,e.nextElementSibling.textContent="",t.classList.add("disabled"))}function formatMonth(t){return t=(t=(t=t.replace(/[ьй]/g,"я")).replace(/рт/g,"рта")).replace(/ст/g,"ста")}function addSearchInput(t,e){var o,i;i="INPUT"==t.tagName?(o=t).parentNode.parentNode.parentNode.parentNode.getElementsByClassName("js-no-results")[0]:(o=t.getElementsByTagName("input")[0],t.getElementsByClassName("js-no-results")[0]),o&&o.addEventListener("input",function(){if(o.value.length){var n=o.value.toLowerCase().trim(),a="remove";Array.prototype.forEach.call(e,function(t){var e=t.getElementsByClassName("js-item-title")[0];~(e=e?e.textContent.toLowerCase():t.textContent.toLowerCase()).indexOf(n)?(t.style.display="",a="add"):t.style.display="none"}),i&&i.classList[a]("hidden")}else Array.prototype.forEach.call(e,function(t){t.style.display=""}),i&&i.classList.add("hidden")})}function selectItem(){if(!this.classList.contains("active")){var t=this.parentNode;t.getElementsByClassName("active")[0].classList.remove("active"),this.classList.add("active"),t.parentNode.classList.remove("active"),t.previousElementSibling.textContent=this.textContent,t.previousElementSibling.setAttribute("data-value",this.getAttribute("data-id"))}}function setCookie(t,e,n){var a="";if(n){var o=new Date;o.setTime(o.getTime()+24*n*60*60*1e3),a="; expires=".concat(o.toUTCString())}document.cookie="".concat(t,"=").concat(e||"").concat(a,"; path=/")}function getCookie(t){for(var e="".concat(t,"="),n=document.cookie.split(";"),a=0;a<n.length;a++){for(var o=n[a];" "==o.charAt(0);)o=o.substring(1,o.length);if(0==o.indexOf(e))return o.substring(e.length,o.length)}return null}function getShortNumber(t){return 1e9<=Math.abs(Number(t))?"".concat((Math.abs(Number(t))/1e9).toFixed(1)," млрд."):1e6<=Math.abs(Number(t))?"".concat((Math.abs(Number(t))/1e6).toFixed(1)," млн."):1e3<=Math.abs(Number(t))?"".concat((Math.abs(Number(t))/1e3).toFixed(1)," тыс."):Math.abs(Number(t))}!function(){if("undefined"!=typeof window)try{var t=new window.CustomEvent("test",{cancelable:!0});if(t.preventDefault(),!0!==t.defaultPrevented)throw new Error("Could not prevent default")}catch(t){var e=function(t,e){var n,a;return(e=e||{}).bubbles=!!e.bubbles,e.cancelable=!!e.cancelable,(n=document.createEvent("CustomEvent")).initCustomEvent(t,e.bubbles,e.cancelable,e.detail),a=n.preventDefault,n.preventDefault=function(){a.call(this);try{Object.defineProperty(this,"defaultPrevented",{get:function(){return!0}})}catch(t){this.defaultPrevented=!0}},n};e.prototype=window.Event.prototype,window.CustomEvent=e}}(),function(t){("object"!=("undefined"==typeof exports?"undefined":_typeof(exports))||"undefined"==typeof module)&&"function"==typeof define&&define.amd?define(t):t()}(function(){function n(){}function i(t){if(!(this instanceof i))throw new TypeError("Promises must be constructed via new");if("function"!=typeof t)throw new TypeError("not a function");this._state=0,this._handled=!1,this._value=void 0,this._deferreds=[],l(t,this)}function o(n,a){for(;3===n._state;)n=n._value;0!==n._state?(n._handled=!0,i._immediateFn(function(){var t=1===n._state?a.onFulfilled:a.onRejected;if(null!==t){var e;try{e=t(n._value)}catch(t){return void s(a.promise,t)}r(a.promise,e)}else(1===n._state?r:s)(a.promise,n._value)})):n._deferreds.push(a)}function r(e,t){try{if(t===e)throw new TypeError("A promise cannot be resolved with itself.");if(t&&("object"==_typeof(t)||"function"==typeof t)){var n=t.then;if(t instanceof i)return e._state=3,e._value=t,void c(e);if("function"==typeof n)return void l((a=n,o=t,function(){a.apply(o,arguments)}),e)}e._state=1,e._value=t,c(e)}catch(t){s(e,t)}var a,o}function s(t,e){t._state=2,t._value=e,c(t)}function c(t){2===t._state&&0===t._deferreds.length&&i._immediateFn(function(){t._handled||i._unhandledRejectionFn(t._value)});for(var e=0,n=t._deferreds.length;e<n;e++)o(t,t._deferreds[e]);t._deferreds=null}function l(t,e){var n=!1;try{t(function(t){n||(n=!0,r(e,t))},function(t){n||(n=!0,s(e,t))})}catch(t){if(n)return;n=!0,s(e,t)}}function t(e){var n=this.constructor;return this.then(function(t){return n.resolve(e()).then(function(){return t})},function(t){return n.resolve(e()).then(function(){return n.reject(t)})})}var e=setTimeout;i.prototype.catch=function(t){return this.then(null,t)},i.prototype.then=function(a,t){var e=new this.constructor(n);return o(this,new function(t,e,n){this.onFulfilled="function"==typeof a?a:null,this.onRejected="function"==typeof e?e:null,this.promise=n}(a,t,e)),e},i.prototype.finally=t,i.all=function(e){return new i(function(a,o){function i(e,t){try{if(t&&("object"==_typeof(t)||"function"==typeof t)){var n=t.then;if("function"==typeof n)return void n.call(t,function(t){i(e,t)},o)}r[e]=t,0==--s&&a(r)}catch(t){o(t)}}if(!e||void 0===e.length)throw new TypeError("Promise.all accepts an array");var r=Array.prototype.slice.call(e);if(0===r.length)return a([]);for(var s=r.length,t=0;r.length>t;t++)i(t,r[t])})},i.resolve=function(e){return e&&"object"==_typeof(e)&&e.constructor===i?e:new i(function(t){t(e)})},i.reject=function(n){return new i(function(t,e){e(n)})},i.race=function(o){return new i(function(t,e){for(var n=0,a=o.length;n<a;n++)o[n].then(t,e)})},i._immediateFn="function"==typeof setImmediate?function(t){setImmediate(t)}:function(t){e(t,0)},i._unhandledRejectionFn=function(t){void 0!==console&&console&&console.warn("Possible Unhandled Promise Rejection:",t)};var a=function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if("undefined"!=typeof global)return global;throw Error("unable to locate global object")}();a.Promise?a.Promise.prototype.finally||(a.Promise.prototype.finally=t):a.Promise=i}),function(t){if(!t.fetch){var e="URLSearchParams"in t,n="Symbol"in t&&"iterator"in Symbol,r="FileReader"in t&&"Blob"in t&&function(){try{return new Blob,!0}catch(t){return!1}}(),a="FormData"in t,o="ArrayBuffer"in t;if(o)var i=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],s=function(t){return t&&DataView.prototype.isPrototypeOf(t)},c=ArrayBuffer.isView||function(t){return t&&-1<i.indexOf(Object.prototype.toString.call(t))};p.prototype.append=function(t,e){t=u(t),e=m(e);var n=this.map[t];this.map[t]=n?n+","+e:e},p.prototype.delete=function(t){delete this.map[u(t)]},p.prototype.get=function(t){return t=u(t),this.has(t)?this.map[t]:null},p.prototype.has=function(t){return this.map.hasOwnProperty(u(t))},p.prototype.set=function(t,e){this.map[u(t)]=m(e)},p.prototype.forEach=function(t,e){for(var n in this.map)this.map.hasOwnProperty(n)&&t.call(e,this.map[n],n,this)},p.prototype.keys=function(){var n=[];return this.forEach(function(t,e){n.push(e)}),f(n)},p.prototype.values=function(){var e=[];return this.forEach(function(t){e.push(t)}),f(e)},p.prototype.entries=function(){var n=[];return this.forEach(function(t,e){n.push([e,t])}),f(n)},n&&(p.prototype[Symbol.iterator]=p.prototype.entries);var l=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];E.prototype.clone=function(){return new E(this,{body:this._bodyInit})},b.call(E.prototype),b.call(w.prototype),w.prototype.clone=function(){return new w(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new p(this.headers),url:this.url})},w.error=function(){var t=new w(null,{status:0,statusText:""});return t.type="error",t};var d=[301,302,303,307,308];w.redirect=function(t,e){if(-1===d.indexOf(e))throw new RangeError("Invalid status code");return new w(null,{status:e,headers:{location:t}})},t.Headers=p,t.Request=E,t.Response=w,t.fetch=function(n,o){return new Promise(function(a,t){var e=new E(n,o),i=new XMLHttpRequest;i.onload=function(){var t,o,e={status:i.status,statusText:i.statusText,headers:(t=i.getAllResponseHeaders()||"",o=new p,t.replace(/\r?\n[\t ]+/g," ").split(/\r?\n/).forEach(function(t){var e=t.split(":"),n=e.shift().trim();if(n){var a=e.join(":").trim();o.append(n,a)}}),o)};e.url="responseURL"in i?i.responseURL:e.headers.get("X-Request-URL");var n="response"in i?i.response:i.responseText;a(new w(n,e))},i.onerror=function(){t(new TypeError("Network request failed"))},i.ontimeout=function(){t(new TypeError("Network request failed"))},i.open(e.method,e.url,!0),"include"===e.credentials?i.withCredentials=!0:"omit"===e.credentials&&(i.withCredentials=!1),"responseType"in i&&r&&(i.responseType="blob"),e.headers.forEach(function(t,e){i.setRequestHeader(e,t)}),i.send(void 0===e._bodyInit?null:e._bodyInit)})},t.fetch.polyfill=!0}function u(t){if("string"!=typeof t&&(t=String(t)),/[^a-z0-9\-#$%&'*+.\^_`|~]/i.test(t))throw new TypeError("Invalid character in header field name");return t.toLowerCase()}function m(t){return"string"!=typeof t&&(t=String(t)),t}function f(e){var t={next:function(){var t=e.shift();return{done:void 0===t,value:t}}};return n&&(t[Symbol.iterator]=function(){return t}),t}function p(e){this.map={},e instanceof p?e.forEach(function(t,e){this.append(e,t)},this):Array.isArray(e)?e.forEach(function(t){this.append(t[0],t[1])},this):e&&Object.getOwnPropertyNames(e).forEach(function(t){this.append(t,e[t])},this)}function v(t){if(t.bodyUsed)return Promise.reject(new TypeError("Already read"));t.bodyUsed=!0}function h(n){return new Promise(function(t,e){n.onload=function(){t(n.result)},n.onerror=function(){e(n.error)}})}function g(t){var e=new FileReader,n=h(e);return e.readAsArrayBuffer(t),n}function y(t){if(t.slice)return t.slice(0);var e=new Uint8Array(t.byteLength);return e.set(new Uint8Array(t)),e.buffer}function b(){return this.bodyUsed=!1,this._initBody=function(t){if(this._bodyInit=t)if("string"==typeof t)this._bodyText=t;else if(r&&Blob.prototype.isPrototypeOf(t))this._bodyBlob=t;else if(a&&FormData.prototype.isPrototypeOf(t))this._bodyFormData=t;else if(e&&URLSearchParams.prototype.isPrototypeOf(t))this._bodyText=t.toString();else if(o&&r&&s(t))this._bodyArrayBuffer=y(t.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer]);else{if(!o||!ArrayBuffer.prototype.isPrototypeOf(t)&&!c(t))throw new Error("unsupported BodyInit type");this._bodyArrayBuffer=y(t)}else this._bodyText="";this.headers.get("content-type")||("string"==typeof t?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):e&&URLSearchParams.prototype.isPrototypeOf(t)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},r&&(this.blob=function(){var t=v(this);if(t)return t;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){return this._bodyArrayBuffer?v(this)||Promise.resolve(this._bodyArrayBuffer):this.blob().then(g)}),this.text=function(){var t,e,n,a=v(this);if(a)return a;if(this._bodyBlob)return t=this._bodyBlob,e=new FileReader,n=h(e),e.readAsText(t),n;if(this._bodyArrayBuffer)return Promise.resolve(function(t){for(var e=new Uint8Array(t),n=new Array(e.length),a=0;a<e.length;a++)n[a]=String.fromCharCode(e[a]);return n.join("")}(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},a&&(this.formData=function(){return this.text().then(L)}),this.json=function(){return this.text().then(JSON.parse)},this}function E(t,e){var n,a,o=(e=e||{}).body;if(t instanceof E){if(t.bodyUsed)throw new TypeError("Already read");this.url=t.url,this.credentials=t.credentials,e.headers||(this.headers=new p(t.headers)),this.method=t.method,this.mode=t.mode,o||null==t._bodyInit||(o=t._bodyInit,t.bodyUsed=!0)}else this.url=String(t);if(this.credentials=e.credentials||this.credentials||"omit",!e.headers&&this.headers||(this.headers=new p(e.headers)),this.method=(n=e.method||this.method||"GET",a=n.toUpperCase(),-1<l.indexOf(a)?a:n),this.mode=e.mode||this.mode||null,this.referrer=null,("GET"===this.method||"HEAD"===this.method)&&o)throw new TypeError("Body not allowed for GET or HEAD requests");this._initBody(o)}function L(t){var o=new FormData;return t.trim().split("&").forEach(function(t){if(t){var e=t.split("="),n=e.shift().replace(/\+/g," "),a=e.join("=").replace(/\+/g," ");o.append(decodeURIComponent(n),decodeURIComponent(a))}}),o}function w(t,e){e=e||{},this.type="default",this.status=void 0===e.status?200:e.status,this.ok=200<=this.status&&this.status<300,this.statusText="statusText"in e?e.statusText:"OK",this.headers=new p(e.headers),this.url=e.url||"",this._initBody(t)}}("undefined"!=typeof self?self:void 0),Object.filter=function(e,n){return Object.assign.apply(Object,_toConsumableArray(Object.keys(e).filter(function(t){return n(e[t])}).map(function(t){return _defineProperty({},t,e[t])})))};var delayCallback=function(){var n=0;return function(t,e){clearTimeout(n),n=setTimeout(t,e)}}();function delayElemCallback(t,e,n){t.timer||(t.timer=0),clearTimeout(t.timer),t.classList.add("js-delayed"),t.callback=function(){return t.classList.remove("js-delayed"),t.timer=null,e()},t.timer=setTimeout(t.callback,n)}var decodeEntities=function(){var e=document.createElement("div");return function(t){return t&&"string"==typeof t&&(t=(t=t.replace(/<script[^>]*>([\S\s]*?)<\/script>/gim,"")).replace(/<\/?\w(?:[^"'>]|"[^"]*"|'[^']*')*>/gim,""),e.innerHTML=t,t=e.textContent,e.textContent=""),t}}();function fadeIn(e,n,a){var o=+new Date;e.style.opacity=0,function t(){e.style.opacity=+e.style.opacity+(new Date-o)/n,o=+new Date,+e.style.opacity<1?requestAnimationFrame(t):a&&a.call(e)}()}function isElementInViewport(t,e){var n=t.getBoundingClientRect();return 0<=n.top&&0<=n.left&&n.bottom<=((e||window).innerHeight||(e||document.documentElement).clientHeight)&&n.right<=((e||window).innerWidth||(e||document.documentElement).clientWidth)}function variableKeyup(t,e){var i=document.getElementById("vars-suggestion-menu");if(!i.classList.contains("active")||!~[37,38,39,40,13].indexOf(t.keyCode)){if(""===this.textContent)this.innerHTML="";else if(30<this.textContent.length){var n,a,o=window.getSelection();0<o.rangeCount&&(n=(a=o.getRangeAt(0)).startOffset),this.textContent=this.textContent.substr(0,30),a&&(a.setStart(this.firstChild,30<n?30:n),a.collapse(!0))}var r=this;13!==t.keyCode&&(e?i.classList.remove("active"):delayCallback(function(){var t=window.getSelection();if(0<t.rangeCount){if(t.getRangeAt(0).collapsed){var e,n=r.textContent.trim();if(e=Emoji.getMatchingUserVariables(n,"name"),i.firstElementChild.innerHTML=e){var a=r.getBoundingClientRect(),o=a.y+20;if(r.classList.contains("js-variable-name")&&(o+=10),a.x)return i.classList.contains("active")||(i.style.transform="translate(".concat(a.x-10,"px,").concat(o,"px)")),void i.classList.add("active")}}i.classList.remove("active")}},350));var s=this.textContent.trim(),c=s.match(/^[a-zA-Zа-яА-ЯёЁ]([_-]?[a-zA-Z0-9а-яА-ЯёЁ]+)*$/);if(this.classList.contains("js-no-insert"))c?this.parentNode.classList.add("active"):this.parentNode.classList.remove("active");else{var l=this.getAttribute("data-variable-id");if(c||l){c?this.parentNode.classList.add("active"):this.parentNode.classList.remove("active");var d=this;delayElemCallback(d,function(){var e=d.getAttribute("data-variable-id");return getJSON("/ajax/get/constructor/template_variables",{new:!0,name:s,previous_variable:e},function(t){t.error?t.deleted&&Emoji.removeVar(e):(d.setAttribute("data-variable-id",t.id),t.new&&Emoji.addVariable({id:t.id,name:s,description:""}))})},500)}else this.parentNode.classList.remove("active")}}}function showWelcomeModal(){var t=document.getElementById("user-welcome-modal");t?$(t).remodal().open():getText("/ajax/get/modal/welcome",function(t){document.body.insertAdjacentHTML("beforeend",t);var s=document.getElementById("user-welcome-modal");s.classList.remove("hidden"),s.addEventListener("click",function(t){var e=t.target.getAttribute("data-action");if(e){var n=s.querySelector("#user-welcome-modal-sections"),a=s.querySelector("#user-welcome-modal-dots"),o=a.getElementsByClassName("active")[0],i=n.getElementsByClassName("active")[0];i.classList.remove("active"),o.classList.remove("active"),"prev"==e?i.previousElementSibling?(i.previousElementSibling.classList.add("active"),o.previousElementSibling.classList.add("active")):(n.firstElementChild.classList.add("active"),a.firstElementChild.classList.add("active")):"next"==e?i.nextElementSibling?(i.nextElementSibling.classList.add("active"),o.nextElementSibling.classList.add("active")):(n.firstElementChild.classList.add("active"),a.firstElementChild.classList.add("active")):"step"==e&&(t.target.classList.add("active"),n.children[t.target.getAttribute("data-step")].classList.add("active"));var r=i.getElementsByTagName("img")[0];r.removeAttribute("src"),(r=(i=n.getElementsByClassName("active")[0]).getElementsByTagName("img")[0]).setAttribute("src",r.getAttribute("data-src"))}}),$(s).remodal().open()})}!function(){document.addEventListener("DOMContentLoaded",function(){if(window!==window.top){var t=document.getElementsByTagName("script")[0],e=document.createElement("script");return e.type="text/javascript",e.async=!0,e.src="https://vk.com/js/api/xd_connection.js?2",e.onload=function(){VK.init(function(){Array.prototype.forEach.call(document.querySelectorAll("[data-app-hide]"),function(t){return t.style.display="none"}),Array.prototype.forEach.call(document.querySelectorAll("[data-app-show]"),function(t){return t.classList.remove("hidden")}),VK.callMethod("setLocation","loc=".concat(window.location.pathname).concat(window.location.search))},function(){},"5.80")},t.parentNode.insertBefore(e,t),!1}var n=document.getElementById("header").getAttribute("data-user-id");try{gtag("set",{userId:n}),yaCounter49303681.setUserID(n)}catch(t){}});var b=$(document.body),t=document.getElementById("csrftoken");getJSON.CSRF="".concat(t.getAttribute("name"),",").concat(t.getAttribute("content"));var e={"X-CSRF-TOKEN":getJSON.CSRF};$.ajaxSetup({headers:e,timeout:15e3}),b.ajaxError(function(t,e,n){"timeout"===e.statusText&&(alertify.okBtn("Обновить страницу").cancelBtn("Отмена").confirm("Похоже, что соединение с сервером потеряно. Попробуйте обновить страницу",function(){location.reload()}),n.success({error:1}))}),alertify.logPosition("right bottom"),document.body.addEventListener("click",function(t){var e=t.target;if(e.classList.contains("js-hide-info-block"))return $.post("/ajax/user/hide_info_block",{id:e.getAttribute("data-id")}),void(e.classList.contains("js-remove-parent-elem")?e.parentNode.parentNode.parentNode.removeChild(e.parentNode.parentNode):e.parentNode.parentNode.removeChild(e.parentNode));for(;e&&!e.hasAttribute("data-tooltip");)e=e.parentElement;if(e){for(var n=t.target;n&&!n.hasAttribute("data-tooltip-ignore");)n=n.parentElement;if(!n){var a=document.querySelector(".active[data-tooltip]");a&&a!==e&&a.classList.remove("active"),e.classList.toggle("active")}}}),document.getElementById("mobile-menu-trigger").addEventListener("click",function(){document.getElementsByTagName("html")[0].classList.toggle("js-mobile-menu-active")});var n=document.getElementById("faq-menu-trigger");n&&n.addEventListener("click",function(){document.getElementsByTagName("html")[0].classList.toggle("js-faq-menu-active")}),document.body.addEventListener("mousedown",function(t){for(var e=t.target;null!==e&&!e.hasAttribute("data-tooltip-ignore")&&!e.hasAttribute("data-tooltip");)e=e.parentElement;if(!e){var n=document.querySelector(".active[data-tooltip]");n&&n.classList.remove("active")}}),live("click",".js-tab",function(){var t=this.parentNode.getElementsByClassName("js-tab active")[0];t&&t.classList.remove("active"),this.classList.add("active");for(var e=this.parentElement;!e.hasAttribute("data-active-tab");)e=e.parentElement;e.setAttribute("data-active-tab",this.getAttribute("data-id"))},document.body),live("keydown",".js-no-line-break",function(t){13===t.keyCode&&t.preventDefault()},document.body),document.body.addEventListener("focusin",function(t){t.target.classList.contains("js-variable-name")&&""===t.target.textContent&&variableKeyup.call(t.target,t)}),b.on("blur",".js-variable-name",function(){var t=document.getElementById("vars-suggestion-menu");t.classList.contains("active")&&t.classList.remove("active"),""===this.textContent&&(this.innerHTML="",this.parentNode.classList.remove("active"),this.setAttribute("data-variable-id",""))}),live("keyup",".js-variable-name",variableKeyup,document.body),live("keyup",".js-vars",function(s){~[9,16,13,17,27,18,37,38,39,40].indexOf(s.keyCode)||delayCallback(function(){var t=window.getSelection();if(0!==t.rangeCount){var e=t.getRangeAt(0),n=e.commonAncestorContainer.parentNode;Emoji.parseVariables(n,"matchMailingTemplate");var a=document.getElementById("vars-suggestion-menu");if(e.collapsed&&!s.ctrlKey){var o,i=e.commonAncestorContainer.textContent;if((i=(i=i.substr(0,e.startOffset)).split(" ").pop())&&"{"===i.charAt(0))if(o="{"===i.charAt(1)?Emoji.getMatchingUserVariables(i):Emoji.getMatchingDefaultVariables(i),a.firstElementChild.innerHTML=o){var r=e.getBoundingClientRect();if(r.x)return a.classList.contains("active")||(a.style.transform="translate(".concat(r.x-10,"px,").concat(r.y+20,"px)")),void a.classList.add("active")}}a.classList.remove("active")}},100)},document.body),document.body.addEventListener("mouseover",function(t){var e=t.target;e.classList.contains("js-vars")&&!e.classList.contains("js-vars-parsed")&&(e.classList.add("js-vars-parsed"),Emoji.parseVariables(e),Emoji.replaceNodesEmoji(e))},document.body);function a(t){if(13===t.keyCode){var e=document.getElementById("vars-suggestion-menu");if(!e.classList.contains("active"))return void setTimeout(function(){var t=window.getSelection().getRangeAt(0).commonAncestorContainer;"SPAN"===t.tagName&&0===t.textContent.length&&(t.outerHTML="<br>")},1);t.preventDefault(),t.stopPropagation(),e.classList.remove("active");var n=e.getElementsByClassName("active")[0].textContent,a=window.getSelection();if(0<a.rangeCount){var o=a.getRangeAt(0),i=o.startOffset,r=o.commonAncestorContainer.textContent,s=r.substr(i),c=r.substr(0,i);(c=c.split(" ")).pop(),c.push(n),o.commonAncestorContainer.textContent="";var l=document.createTextNode(c.join(" ")+s);return o.insertNode(l),o.collapse(!0),o.setStart(l,l.textContent.length),Emoji.parseVariables(l.parentNode),!1}}else if(~[38,40].indexOf(t.keyCode)){var d=document.getElementById("vars-suggestion-menu");if(!d.classList.contains("active"))return;t.preventDefault();var u="nextElementSibling",m="firstElementChild";38==t.keyCode&&(u="previousElementSibling",m="lastElementChild");var f=d.getElementsByClassName("active")[0];f.classList.remove("active"),f[u]?(f[u].classList.add("active"),f[u].offsetTop<d.firstElementChild.scrollTop?f[u].scrollIntoView():f[u].offsetTop-d.firstElementChild.scrollTop>d.firstElementChild.clientHeight&&(d.firstElementChild.scrollTop+=f[u].clientHeight)):(d.firstElementChild[m].classList.add("active"),d.firstElementChild[m].scrollIntoView())}else~[37,39].indexOf(t.keyCode)&&document.getElementById("vars-suggestion-menu").classList.remove("active")}live("keydown",".js-vars",a,document.body),live("keydown",".js-variable-name",a,document.body),live("click",".js-remove-var-row",function(){if(this.hasAttribute("data-parent")){for(var t=1,e=this.getAttribute("data-parent"),n=this;t<e;)n=n.parentNode,t++;n.parentNode.removeChild(n)}else this.parentNode.parentNode.removeChild(this.parentNode)},document.body),live("click",".js-add-variable-row",function(){var t,e=this.getAttribute("data-limit");if(e&&e<=this.parentNode.parentNode.getElementsByClassName("js-variables-row").length)return alertify.error("Нельзя добавить больше ".concat(e," строк")),!1;if(this.classList.contains("js-responsivetable")){var n=this.parentNode.previousElementSibling.lastElementChild.outerHTML;this.parentNode.previousElementSibling.insertAdjacentHTML("beforeend",n),t=this.parentNode.previousElementSibling.lastElementChild}else{var a=this.parentNode.previousElementSibling.outerHTML;this.parentNode.insertAdjacentHTML("beforebegin",a),t=this.parentNode.previousElementSibling}Array.prototype.forEach.call(t.querySelectorAll("[contenteditable]"),function(t){t.parentNode.classList.remove("active"),t.innerHTML=""}),t.getElementsByClassName("js-remove-var-row")[0].classList.remove("hidden")},document.body),live("paste",".js-contenteditable",function(t){var e;if(t.preventDefault(),window.clipboardData)return e=(e=window.clipboardData.getData("Text")).replace(/\n/g,"<br>"),void window.getSelection().getRangeAt(0).insertNode(document.createTextNode(e));e=(e=(t.originalEvent||t).clipboardData.getData("text/plain")).replace(/\n/g,"<br>"),e=wdtEmojiBundle.replaceDefaultEmoji(e),window.document.execCommand("insertHtml",!1,e)},document.body);var o=document.getElementById("header-active-profile-nav");function i(t){Array.prototype.forEach.call(t.getElementsByClassName("js-select-active-profile"),function(t){t.addEventListener("click",function(){$.post("/ajax/profiles/select",{id:this.getAttribute("data-id")},function(t){t.error||location.reload()})})})}function r(){o.removeEventListener("click",r),o.removeEventListener("mouseenter",r),getJSON("/ajax/profiles/get",function(t){if(0<t.count){var e=document.getElementById("header-profiles-count");e.classList.remove("hidden"),e.textContent=t.count;var n=document.getElementById("header-connected-profiles-list");n.innerHTML=t.view,n.classList.remove("hidden"),n.previousElementSibling.style.display="none",i(n)}})}if(o){o.addEventListener("click",r),o.addEventListener("mouseenter",r),document.getElementById("mobile-menu-trigger").addEventListener("click",r,{once:!0});var s=document.getElementById("user-profiles-list");s&&i(s),document.getElementById("user-logout").addEventListener("click",function(){$.post("/ajax/session/logout",{},function(t){t.error||(location.href="/")})}),document.getElementById("header-profile-tooltip-managing").addEventListener("click",function(){var e=this;e.classList.add("active"),e.classList.contains("js-events-are-bound")||(e.classList.add("js-events-are-bound"),document.getElementById("header-profile-tooltip-back-btn").addEventListener("click",function(t){t.stopPropagation(),e.classList.remove("active")}),e.addEventListener("blur",function(){setTimeout(function(){e.classList.remove("active")},200)}))})}function c(){this.removeEventListener("mouseenter",c),this.removeEventListener("click",c);var t=document.getElementById("header-chat-bot-selector").getAttribute("data-template-id"),o=this;getJSON("/ajax/get/templates",{id:t},function(t){var e=o.querySelector("#header-chat-bots-list"),n="";t.list.sort(function(t,e){return e.is_favorite?1:t.bot_name&&t.is_favorite&&t.bot_name>e.bot_name?0:-1}),t.list.forEach(function(t){n+='<li class="js-chat-row" data-id="'.concat(t.id,'" title="').concat(t.name,'">                <img src="').concat(t.photo_100||"/img/db/default_template.png",'" alt="" class="avatar">                    <div class="label js-item-title">').concat(t.name,'</div> <p class="subtext">').concat(t.bot_name||"Сообщество не подключено","</p></li>")}),0===t.list.length?n='<div class="empty-list"><p>Шаблоны отсутствуют</p></div>':5<t.list.length?(n="<div class='search-wrapper'><input type='text' placeholder='Найти шаблон...'></div><ul>".concat(n,"</ul>"),n+='<div class="empty-list js-no-results hidden"><p>Ничего не найдено</p></div>'):n="<ul>".concat(n,"</ul>"),e.innerHTML="".concat(n,'<div class="add-new-community"><a href="/connect"></a>Добавить сообщество <img src="/svg/db/nav/plus_blue.svg" alt="" class="inline-icon"></div>');var a=e.getElementsByClassName("js-chat-row");Array.prototype.forEach.call(a,function(t){t.addEventListener("click",function(){var t=this.getAttribute("data-id");$.post("/ajax/profile/active_template",{id:t},function(t){if(!t.error){var e=new URLSearchParams(document.location.search).get("act")||"";e&&null!==e&&(e="?act=".concat(e)),location.href=document.location.pathname+e}})})}),addSearchInput(e,a)})}var l=document.getElementById("header-chat-bot-selector");l&&!l.parentNode.parentNode.classList.contains("add-status")&&(l.addEventListener("mouseenter",c),l.addEventListener("click",c));var E=document.getElementById("my-templates-list");if(E){var d,u,L=function(n,t,a){n.length<2?alertify.error("Минимум 2 символа для название шаблона"):(n=n.substr(0,255).trim(),$.post("/ajax/constructor/template/create",{id:t,title:n},function(t){if(a&&"BUTTON"===a.tagName&&a.classList.remove("js-loading-gray"),t.error)alertify.error("Не удалось создать шаблон");else{$("#public-template-preview-remodal").remodal().close(),document.getElementById("panel-tab").click();var e=document.getElementById("blank-template").firstElementChild.cloneNode(!0);document.getElementById("new-template-block").insertAdjacentElement("afterend",e),e.classList.remove("hidden"),e.getElementsByClassName("js-template-title")[0].textContent=n,e.setAttribute("data-id",t.id),fadeIn(e,1200,function(){this.style.opacity=""}),alertify.success("Шаблон создан")}}))},m={};/iPhone|iPad|iPod|Android|Opera Mini|IEMobile|BlackBerry/i.test(navigator.userAgent)||Sortable.create(E,{group:{name:"templates",pull:function(t,e,n,a){var o=document.getElementsByClassName("js-folder-item js-dragover")[0];if(o&&o.classList.remove("js-dragover"),a.target.nodeType!==Node.TEXT_NODE){var i=getParent(a.target,"js-folder-item");d=i?(i.classList.add("js-dragover"),i.getAttribute("data-id")):null}else d=null}},sort:!0,animation:150,delayOnTouchOnly:150,draggable:".js-template",dragClass:"sortable-drag",onEnd:function(t){var a,o;o=t.oldIndex>t.newIndex?(a=t.newIndex,t.oldIndex):(a=t.oldIndex,t.newIndex),1!==(m=Array.prototype.reduce.call(E.children,function(t,e,n){return a<=n&&n<=o&&t.push({id:e.getAttribute("data-id"),pos:n}),t},[])).length&&($.post("/ajax/constructor/template/position",{position:m,type:"template"}),m={})},onChoose:function(t){u=t.item.getAttribute("data-id")},onUnchoose:function(a){if(null!==d){var o=d;if(d=null,document.querySelector('.js-template[data-id="'.concat(u,'"]')).getAttribute("data-folder")!==o){$.post("/ajax/constructor/template/put",{folder_id:o,template_id:u}).then(function(t){if(!t.error){var e=a.item.getAttribute("data-folder"),n=document.querySelector('.js-folder-item[data-id="'.concat(e,'"]')).querySelector(".js-folder-items-count");n.textContent--,(n=document.querySelector('.js-folder-item[data-id="'.concat(o,'"]')).querySelector(".js-folder-items-count")).textContent++,a.item.classList.add("hidden"),a.item.setAttribute("data-folder",o),alertify.success(t.message)}}).catch(function(t){console.error(t)});var t=document.getElementsByClassName("js-folder-item js-dragover")[0];t&&t.classList.remove("js-dragover")}else alertify.error("Шаблон уже помещён в эту папку")}}});var f=document.getElementById("folders-list"),p=document.getElementById("button_add_folder"),v=f.childNodes[1].cloneNode(!0),h=f.children;12<=h.length&&p.classList.add("disabled"),Array.prototype.forEach.call(f.getElementsByClassName("js-folder-item"),function(t){var e=t.getAttribute("data-id");t.querySelector(".js-folder-items-count").textContent=document.querySelectorAll('[data-folder="'.concat(e,'"]')).length}),f.addEventListener("contextmenu",function(t){t.preventDefault();var e=getParent(t.target,"js-folder-item");e&&e.querySelector(".js-dropdown-container").click()}),f.addEventListener("click",function(t){var n=t.target;if(getParent(n,"js-rename-folder")){var a=getParent(n,"js-folder-item").children[2];a.classList.remove("hidden"),a.nextElementSibling.classList.add("hidden"),a.hide=function(){a.classList.add("hidden"),a.nextElementSibling.classList.remove("hidden"),a.nextElementSibling.textContent=a.value.trim()},a.save=function(){var t=a.value.trim();0<t.length&&t!==e&&$.post("/ajax/constructor/folder/rename",{name:t,folder_id:getParent(a,"js-folder-item").getAttribute("data-id")}),a.hide()};var e=a.nextElementSibling.textContent;a.value=e,a.select(),a.onkeyup||(a.onkeyup=function(t){13===t.keyCode?a.save():27===t.keyCode&&(a.value=e,a.hide())}),setTimeout(function(){!function e(){document.addEventListener("click",function(t){n.classList.contains("js-folder-name-input")?e():a.save()},{once:!0})}()},100),getParent(n,"dropdown-container").classList.remove("active")}else if(getParent(n,"js-delete-folder")){var o=getParent(n,"js-folder-item"),i=o.getAttribute("data-id");$.post("/ajax/constructor/folder/delete",{folderId:i}).then(function(t){if(!t.error){var e=document.getElementsByClassName("js-folder-item active")[0];Array.prototype.forEach.call(document.querySelectorAll('[data-folder="'.concat(i,'"]')),function(t){t.setAttribute("data-folder",""),e||t.classList.remove("hidden")}),o.classList.contains("active")&&o.click(),Array.prototype.forEach.call(f.getElementsByClassName("js-folder-item"),function(t){var e=t.getAttribute("data-id");t.querySelector(".js-folder-items-count").textContent=document.querySelectorAll('[data-folder="'.concat(e,'"]')).length}),alertify.success("Папка удалена"),o.parentNode.removeChild(o)}}),getParent(n,"dropdown-container").classList.remove("active")}else{var r=getParent(n,"js-dropdown-container");if(r){if(getParent(n,"js-dropdown-content"))return;return void r.classList.toggle("active")}var s=getParent(n,"js-folder-item");if(s){Array.prototype.forEach.call(document.getElementsByClassName("js-folder-item"),function(t){t===s?t.classList.toggle("active"):t.classList.remove("active")});var c=s.classList.contains("active")?s.getAttribute("data-id"):"",l=document.getElementsByClassName("js-template");Array.prototype.forEach.call(l,function(t){t.getAttribute("data-folder")===c?t.classList.remove("hidden"):t.classList.add("hidden")}),""===c?(f.firstElementChild.style.display="none",f.firstElementChild.classList.remove("active")):f.firstElementChild.style.display=""}}}),document.body.addEventListener("mousedown",function(t){var e=document.getElementsByClassName("dropdown-container active"),n=!0,a=!1,o=void 0;try{for(var i,r=e[Symbol.iterator]();!(n=(i=r.next()).done);n=!0){var s=i.value;if(getParent(t.target,"active"))return;s.classList.remove("active")}}catch(t){a=!0,o=t}finally{try{n||null==r.return||r.return()}finally{if(a)throw o}}}),Sortable.create(f,{group:{name:"folders",put:"template"},dragoverBubble:!1,sort:!0,animation:150,filter:"[data-main-folder]",draggable:".js-folder-item",onEnd:function(t){var a,o;o=t.oldIndex>t.newIndex?(a=t.newIndex,t.oldIndex):(a=t.oldIndex,t.newIndex),1!==(m=Array.prototype.reduce.call(f.children,function(t,e,n){return a<=n&&n<=o&&t.push({id:e.getAttribute("data-id"),pos:n}),t},[])).length&&$.post("/ajax/constructor/template/position",{position:m,type:"folder"})}});var g=document.getElementsByClassName("js-folder-item");Array.prototype.forEach.call(g,function(t){Sortable.create(t,{group:{name:"folder"},sort:!1,draggable:""})}),p.addEventListener("click",function(){var e=v.cloneNode(!0);e.removeAttribute("style"),e.removeAttribute("data-main-folder"),e.children[1].nextElementSibling.nextElementSibling.textContent="Новая папка",$.post("/ajax/constructor/folder/create",{}).then(function(t){e.setAttribute("data-id",t.id),p.insertAdjacentElement("beforebegin",e)}),11<=h.length&&this.classList.add("disabled")});var y=document.getElementById("poll-modal");y&&(setTimeout(function(){$(y).remodal().open()},200),document.getElementById("continue-poll-btn").addEventListener("click",function(){var e=this;this.firstElementChild.textContent="Продолжить";var t,n=this.getAttribute("data-step"),a=document.querySelector('.js-poll-question[data-step="'.concat(n,'"]'));if(a&&(t=a.querySelector("input:checked")),!t&&0<n)alertify.error("Пожалуйста, выберите вариант ответа");else{if(e.classList.add("disabled"),this.setAttribute("data-step",+n+1),document.getElementById("poll-content").classList.remove("hidden"),document.getElementById("poll-header").classList.add("hidden"),n<5){var o=document.querySelector('.js-poll-question[data-step="'.concat(+n+1,'"]'));o.classList.remove("hidden"),o.addEventListener("click",function(t){"INPUT"===t.target.tagName&&e.classList.remove("disabled")})}0<n&&document.querySelector('.js-poll-question[data-step="'.concat(n,'"]')).classList.add("hidden");var i=t?t.value:null;$.post("/ajax/poll/answer",{step:n,answer:i}),"5"===n?($(y).remodal().close(),alertify.success("Благодарим за прохождение опроса!")):document.getElementById("poll-information-text").textContent="Вопрос ".concat(+n+1," из 5")}}),b.on("closing","#poll-modal",function(){$.post("/ajax/poll/answer",{step:0})})),E.addEventListener("click",function(t){var e=t.target,n=e.parentNode;if(n.classList.contains("js-template")){var a=n.getAttribute("data-id");$.post("/ajax/profile/active_template",{id:a},function(t){t.error||(location.href="/bot")})}else if("H4"!=e.tagName||e.hasAttribute("contenteditable")){if(n.classList.contains("js-unbind-group")||e.classList.contains("js-unbind-group")&&(n=t.target)){var o=n.parentNode.parentNode.parentNode.parentNode.parentNode.getAttribute("data-id");alertify.okBtn("Отвязать сообщество").cancelBtn("Отмена").confirm("После отключения сообщества от шаблона, бот не сможет отвечать на команды. Вы уверены, что хотите продолжить?",function(){$.post("/ajax/constructor/template/unbind",{template_id:o},function(t){t.error?alertify.error("Не удалось отвязать сообщество"):location.reload()})})}else if(n.classList.contains("js-rename-template")||e.classList.contains("js-rename-template")&&(n=t.target)){var i=n.parentNode.parentNode.parentNode,r=i.parentNode.getElementsByClassName("js-template-title")[0];i.parentNode.parentNode.classList.add("js-edit-title"),i.classList.remove("active"),r.setAttribute("contenteditable","true"),r.setAttribute("data-content",r.textContent.trim()),r.focus();var s=r.nextElementSibling.getElementsByClassName("js-save-title-btn")[0];s.classList.remove("hidden"),s.previousElementSibling.classList.add("hidden")}else if(e.classList.contains("js-save-title-btn")){var c=n.parentNode.parentNode.getAttribute("data-id"),l=n.previousElementSibling,d=l.textContent.trim();if(d=d.substr(0,255),l.parentNode.parentNode.classList.remove("js-edit-title"),d==l.getAttribute("data-content"))return l.removeAttribute("contenteditable"),e.previousElementSibling.classList.remove("hidden"),void e.classList.add("hidden");$.post("/ajax/constructor/template/update/title",{id:c,title:d},function(t){t.error?alertify.error("Не удалось сохранить"):(l.removeAttribute("contenteditable"),e.previousElementSibling.classList.remove("hidden"),e.classList.add("hidden"),alertify.success("Сохранено"))})}else if(e.classList.contains("js-delete-template")||n.classList.contains("js-delete-template")&&(n=n.parentNode)){var u=n.parentNode.parentNode.parentNode.parentNode,m=u.getAttribute("data-id"),f=document.getElementById("prompt-modal"),p=f.querySelector("#prompt-modal-input");$(f).remodal().open(),p.focus();var v=f.querySelector("#prompt-confirm-btn");v.setAttribute("data-id",m),p.parentNode.previousElementSibling.firstElementChild.textContent=u.getElementsByClassName("js-template-title")[0].textContent,f.classList.contains("js-inited")||(f.classList.add("js-inited"),b.on("closed","#prompt-modal-content",function(){f.querySelector("#prompt-modal-input").value=""}),f.querySelector("#prompt-modal-input").addEventListener("input",function(){var t=this.value.trim(),e=f.querySelector("#prompt-confirm-btn");"УДАЛИТЬ"===t?(e.classList.remove("disabled"),e.focus()):e.classList.add("disabled")}),v.addEventListener("click",function(){var n=this,a=n.getAttribute("data-id");n.classList.add("js-loading"),$.post("/ajax/constructor/template/delete",{id:a},function(t){if(n.classList.remove("js-loading"),t.error)alertify.error("Не удалось удалить");else{$(f).remodal().close(),alertify.success("Шаблон удалён");var e=document.querySelector('.js-template[data-id="'.concat(a,'"]'));e.parentNode.removeChild(e),p.value=""}})}))}else if(e.classList.contains("js-copy-template")||n.classList.contains("js-copy-template")&&(n=n.parentNode))alertify.okBtn("Копировать шаблон").cancelBtn("Отмена").prompt("Введите название шаблона",function(t){L(t,n.parentNode.parentNode.parentNode.parentNode.getAttribute("data-id"))});else if(e.classList.contains("js-add-to-favorite")){var h=getParent(e,"js-template");h.classList.toggle("js-favorite");var g=h.getAttribute("data-id");$.post("/ajax/constructor/template/favorite",{id:g},function(t){if(t.error)return h.classList.toggle("js-favorite"),void alertify.error("Не удалось добавить шаблон в избранное");h.classList.contains("js-favorite")&&(E.firstElementChild.insertAdjacentHTML("afterend",h.outerHTML),h.parentNode.removeChild(h)),alertify.success("Шаблон ".concat(h.classList.contains("js-favorite")?"добавлен в избранное":"удалён из избранного"))})}}else{var y=n.parentNode.getAttribute("data-id");if(!y)return!0;$.post("/ajax/profile/active_template",{id:y},function(t){t.error?alertify.error("Не удалось перейти к шаблону"):location.href="/bot"})}}),$("#public-templates-list").on("click",".js-public-template",function(){var t=document.getElementById("public-template-preview-remodal");$(t).remodal().open();var e=this.getElementsByClassName("js-template-title")[0];t.getElementsByTagName("img")[0].setAttribute("src",this.getElementsByTagName("img")[0].getAttribute("src"));var n=t.getElementsByClassName("js-template-title")[0];n.textContent=e.textContent,n.nextElementSibling.textContent=e.nextElementSibling.textContent,n.nextElementSibling.nextElementSibling.textContent=e.nextElementSibling.nextElementSibling.textContent,t.setAttribute("data-color",this.getAttribute("data-color"));var a=t.querySelector("#use-public-template");a.setAttribute("data-id",this.getAttribute("data-id")),a.nextElementSibling.setAttribute("href",this.getAttribute("data-preview"))}),document.getElementById("add-blank-template").addEventListener("click",function(){alertify.okBtn("Создать шаблон").cancelBtn("Отмена").prompt("Введите название шаблона",function(t){L(t,0)}),setTimeout(function(){var t=document.getElementsByClassName("alertify")[0];t&&(t.getElementsByTagName("input")[0].value="Новый шаблон")},50)}),Array.prototype.forEach.call(document.getElementsByClassName("js-view-type"),function(t){t.addEventListener("click",function(){if(!this.classList.contains("active")){var t=this.nextElementSibling?this.nextElementSibling:this.previousElementSibling,e=this.getAttribute("data-action");this.classList.add("active"),t.classList.remove("active"),setCookie("view-type",e,30),document.getElementById("my-templates-list").classList[this.getAttribute("data-action")]("templates-list--row-type")}})}),document.querySelector('.js-view-type[data-action="'+(getCookie("view-type")||"remove")+'"]').click(),document.getElementById("use-public-template").addEventListener("click",function(){var t=this.getAttribute("data-id"),e=this.parentNode.parentNode.getElementsByClassName("js-template-title")[0].textContent;this.classList.add("js-loading-gray"),L(e,t,this)}),$(E).on("keypress",function(t){13===t.keyCode&&t.preventDefault()}),live("paste",".js-template-title",function(t){var e;if(t.preventDefault(),window.clipboardData)return e=window.clipboardData.getData("Text"),void window.getSelection().getRangeAt(0).insertNode(document.createTextNode(e));e=(t.originalEvent||t).clipboardData.getData("text/plain"),window.document.execCommand("insertHtml",!1,e)},E)}b.on("click touchdown",".js-connect-bot",function(){var o=this.parentNode.parentNode.parentNode.getAttribute("data-id")||document.getElementById("header-chat-bot-selector").getAttribute("data-template-id");getJSON("/ajax/get/template_bots",function(t){if(!t.error){var a=document.getElementById("templates-bots-list");a.innerHTML=t.list.reduce(function(t,e){var n=e.template_name,a=" js-has-template";return n||(n="Нет шаблона",a=""),t+='<div class="table-row js-bot-item'.concat(a,'" data-id="').concat(e.id,'">')+'                <div>                    <div class="status-icon"></div>'+'                    <img src="'.concat(e.photo_100,'" alt="" class="table__row-image">')+'                    <div class="label">'.concat(e.name,"</div>")+"                    <p>".concat(n,"</p>")+"                </div>            </div>"},""),5<t.list.length&&(a.previousElementSibling&&a.parentNode.removeChild(a.previousElementSibling),a.insertAdjacentHTML("beforebegin",'<div class="search-wrapper"><input type="text" placeholder="Найти сообщество..."></div>'),addSearchInput(a.previousElementSibling.firstElementChild,a.children)),a.classList.contains("js-inited")||(a.classList.add("js-inited"),$(a).on("click",".js-bot-item",function(){var t=this.parentNode.getElementsByClassName("js-selected")[0];t&&t!==this&&t.classList.remove("js-selected"),this.classList.add("js-selected");var e=document.getElementById("connect-template");e.textContent="Подключить к шаблону",e.classList.remove("disabled")}),document.getElementById("connect-template").addEventListener("click",function(){var t=a.getElementsByClassName("js-selected")[0],e=t.getAttribute("data-id");function n(){$.post("/ajax/constructor/template/connect",{template_id:o,bot_id:e},function(t){t.error?alertify.error("Не удалось подключить шаблон"):location.reload()})}t.classList.contains("js-has-template")?alertify.okBtn("Да, изменить").cancelBtn("Отмена").confirm("Выбранное сообщество уже привязано к другому шаблону. Вы уверены, что хотите изменить активный шаблон?",n):n()})),$("#connect-template-bot-modal").remodal().open()}})});var w,N=document.getElementById("connect-bots-btn");if(N){"#welcome"===location.hash&&(showWelcomeModal(),$(document.body).on("closing","#user-welcome-modal",function(){window.location.hash=""})),document.getElementById("update-vk-groups-list").addEventListener("click",function(){$.post("/ajax/vk/groups/update_list",{},function(t){t.error||location.reload()})});var C=0,j=0,x=document.getElementById("new-bots-table");if(x){var A=x.getElementsByClassName("js-chat-bot-item");Array.prototype.forEach.call(A,function(t){t.classList.contains("js-connected")?C++:j++}),w=x,Array.prototype.forEach.call(w.getElementsByClassName("js-chat-bot-item"),function(t){t.addEventListener("click",function(t){if(!this.classList.contains("js-connected")&&!this.classList.contains("js-error")&&!this.classList.contains("js-not-member"))if(this.classList.contains("js-need-auth"))t.preventDefault(),alertify.okBtn("Продолжить").okBtnLink("/profiles/login/vk",window!==window.top).cancelBtn("Отмена").confirm('Нажмите "Продолжить", чтобы войти на сайт в новом окне и добавить сообщества',function(){setTimeout(function(){document.getElementById("update-vk-groups-list").click()},5e3)});else{toggleButtonText.call(this,N,N.firstElementChild.nextElementSibling);var e=x.getElementsByClassName("js-selected"),n=Array.prototype.map.call(e,function(t){return t.getAttribute("data-id")}).join(","),a="https://oauth.vk.com/authorize?client_id="+N.getAttribute("data-app-id")+"&scope=wall,stories,manage,messages,photos,docs&redirect_uri="+window.location.protocol+"//"+window.location.host+"/oauth/vk/group&group_ids="+n+"&response_type=code&v=5.77";N.nextElementSibling.setAttribute("href",a),window!==window.top&&N.nextElementSibling.setAttribute("target","_blank")}}),t.getElementsByClassName("js-remove-chat-bot")[0].addEventListener("click",function(){var t=this.getAttribute("data-id");alertify.okBtn("Удалить").cancelBtn("Отмена").confirm("Удалить бота сообщества и доступ к нему у всех пользователей Робочата? Шаблоны и настройки потеряны НЕ будут.",function(){$.post("/ajax/bot/remove",{id:t},function(t){t.error||location.reload()})})})})}var k=document.getElementById("show-all-chat-bots-btn");if(k)k.addEventListener("click",function(){x.classList.remove("js-elements-hidden"),this.parentNode.removeChild(this),k=null});else if(document.getElementById("profile-access-error")){var S=document.getElementById("profile-access-error").value;alertify.okBtn("Перезайти").okBtnLink("/profiles/login/vk",window!==window.top).cancelBtn("Отмена").confirm("Нет доступа к аккаунту ".concat(S,". Переподключите его, чтобы отобразить<br> список сообществ."))}var B=document.getElementById("search-groups-input");B&&(B.focus(),addSearchInput(B,x.children),B.addEventListener("input",function(){k&&k.click()},{once:!0})),document.getElementById("connected-groups-count").textContent="(".concat(C,")"),document.getElementById("not-connected-groups-count").textContent="(".concat(j,")"),Array.prototype.forEach.call(document.getElementById("bots-filter-tabs").getElementsByTagName("li"),function(t){t.addEventListener("click",function(){if(this.classList.contains("active"))return!1;if(x){k?k.click():x.classList.remove("js-elements-hidden");var t=this.getAttribute("data-filter");this.parentNode.getElementsByClassName("active")[0].classList.remove("active"),this.classList.add("active");var e=x.getElementsByClassName("js-chat-bot-item"),n=document.getElementById("bots-empty-list"),a=0;if(n&&n.classList.add("hidden"),1==t)Array.prototype.forEach.call(e,function(t){t.style.display=""});else{var o="";2==t?Array.prototype.forEach.call(e,function(t){t.classList.contains("js-connected")?(t.style.display="",a++):t.style.display="none"}):(Array.prototype.forEach.call(e,function(t){t.classList.contains("js-connected")?t.style.display="none":(a++,t.style.display="")}),o=" не"),n&&0===a&&(n.classList.remove("hidden"),n.textContent="Нет".concat(o," подключенных сообществ"))}}else alertify.error("Не найдено ни одного сообщества")})})}!function(){Array.prototype.forEach.call(document.getElementsByClassName("js-unlink-profile"),function(t){t.addEventListener("click",function(){var t=this.getAttribute("data-id");alertify.okBtn("Отвязать").cancelBtn("Отмена").confirm("Отвязать аккаунт от вашей учетной записи?",function(){$.post("/ajax/profiles/remove",{id:t},function(t){t.error?alertify.error("Ошибка"):location.reload()})})})}),"?welcome"===window.location.search&&document.getElementById("intro-tooltip").classList.add("active");var i=!1;document.addEventListener("keydown",function(t){if(17==t.keyCode||91==t.keyCode)i=!0;else if(83==t.keyCode){if(i){t.preventDefault();var e=document.getElementsByClassName("js-ctrl-s-key")[0];e&&!e.classList.contains("js-loading")&&e.click()}}else if(27==t.keyCode){var n=document.getElementById("vars-suggestion-menu");if(n&&n.classList.contains("active"))return void n.classList.remove("active");var a=document.getElementsByClassName("js-esc-key")[0];if(a){var o=document.getElementsByClassName("js-event-attached")[0];o?o.click():document.getElementsByClassName("remodal-is-opened")[0]||document.getElementsByClassName("remodal-is-opening")[0]||document.getElementsByClassName("alertify")[0]||a.classList.contains("js-loading-gray")||(a.click(),a.classList.add("js-loading-gray"))}}}),document.addEventListener("keyup",function(t){17!=t.keyCode&&91!=t.keyCode||(i=!1)})}(),window.addEventListener("error",function(t){$.post("/ajax/bot/constructor/log",{error:t})}),document.getElementById("how-to-start-info")&&document.getElementById("how-to-start-info").addEventListener("click",function(){showWelcomeModal()}),document.getElementById("hide-chatus-promo")&&document.getElementById("hide-chatus-promo").addEventListener("click",function(){var t=this.parentNode.parentNode;t.parentNode.removeChild(t),$.post("/ajax/user/hide_info_block",{id:6})}),null===getCookie("ts_offset")&&setCookie("ts_offset",60*(new Date).getTimezoneOffset(),30)}();var Charts={_series:null,_period:"today",minDate:null,conf:{lineConfig:{title:"",chart:{zoomType:"x",type:"spline",resetZoomButton:{theme:{r:3,height:14,width:100}}},yAxis:[{title:{text:""}},{title:{text:""},opposite:!0}],tooltip:{shared:!0,borderRadius:5,padding:6,useHTML:!0,formatter:function(){var t=this.points[0].key;t=~t.indexOf(":")?"".concat(t," - ").concat(t.split(":")[0],":59"):(t=Charts._series[this.points[0].point.x],t=flatpickr.parseDate(new Date(1e3*t),"H:i d-m-y"),"year"===Charts._period?flatpickr.formatDate(t,"F Y"):formatMonth(flatpickr.formatDate(t,"j F Y"))+flatpickr.formatDate(t,", l"));var e="<small>".concat(t,"</small><table>");return this.points.forEach(function(t){e+='<tr><td class="text"><tspan class="ellipse highcharts-color-'.concat(t.series.index,'" x="10" dy="15">●</tspan>').concat(t.series.name,": </td>")+'<td class="point"><strong>'.concat(getSeparatedNumber(t.point.y),"</strong></td></tr>")}),e+="</table>"}},legend:{align:"left",verticalAlign:"top",borderWidth:0},credits:{enabled:!1},responsive:{rules:[{condition:{maxWidth:500},chartOptions:{legend:{layout:"horizontal",align:"center",verticalAlign:"bottom"}}}]}},columnConfig:{chart:{type:"column"},credits:{enabled:0,text:"robochat.io",href:null},title:"",xAxis:{categories:["до 18","от 18 до 21","от 21 до 24","от 24 до 27","от 27 до 30","от 30 до 35","от 35 до 45","от 45"],crosshair:!0},yAxis:{min:0,title:{text:""},labels:{formatter:function(){return"".concat(this.value,"%")}}},tooltip:{headerFormat:'<small style="text-transform: capitalize">{point.key}</small><table>',pointFormat:'<tr><td class="text"><tspan class="ellipse highcharts-color-{series.index}" x="10" dy="15">●</tspan>{series.name}</td><td class="point"><strong>{point.y:.1f}%</strong></td></tr>',footerFormat:"</table>",shared:!0,useHTML:!0},plotOptions:{column:{pointPadding:.2,borderWidth:0}},series:[{name:"Мужчины",data:[49.9,71.5,106.4,129.2,144,176,135.6,148.5]},{name:"Женщины",data:[83.6,78.8,98.5,93.4,106,84.5,105,104.3]}]},pieConfig:{chart:{plotBackgroundColor:null,plotBorderWidth:null,plotShadow:!1,type:"pie"},credits:{enabled:0,text:"robochat.io",href:null},title:"",tooltip:{headerFormat:'<small style="text-transform: capitalize!important">{point.key}</small><table>',pointFormat:'<tr><td class="text"><tspan class="ellipse highcharts-color-{series.index}" x="10" dy="15">●</tspan>{series.name}</td><td class="point"><strong>{point.percentage:.1f}%</strong></td></tr>',footerFormat:"</table>",shared:!0,useHTML:!0}}},init:function(){Highcharts.setOptions({lang:{resetZoom:"Отдалить график",resetZoomTitle:"Вернуть масштаб 1:1"}})},getCategories:function(n,t){var a;switch(t){case"today":case"yesterday":a="H:00";break;case"week":case"month":case"quarter":a="j M";break;case"year":a="F";break;default:var e=t.split(",");a=e[1]-e[0]==0?"H:00":"j M"}return n.forEach(function(t,e){t=flatpickr.parseDate(new Date(1e3*t),"H:i d-m-y"),n[e]=flatpickr.formatDate(t,a)}),n},addDateRangePicker:function(e,i){function r(t){e.firstElementChild.nextSibling.textContent=t}return flatpickr(e,{altInput:!0,altFormat:"j F, Y H:i",dateFormat:"H:i d-m-y",maxDate:new Date,minDate:Charts.minDate,inline:!0,mode:"range",onValueUpdate:function(t,e){if(~e.indexOf(" to ")){var n=e.split(" to ");n[0]=flatpickr.parseDate(n[0],"H:i d-m-y"),n[1]=flatpickr.parseDate(n[1],"H:i d-m-y");var a=Math.round(n[0].getTime()/1e3),o=Math.round(n[1].getTime()/1e3);i(this,"".concat(a,",").concat(o),!0),n[0].getTime()!==n[1].getTime()?(n[0]=flatpickr.formatDate(n[0],"j M Y"),n[1]=flatpickr.formatDate(n[1],"j M Y"),r("".concat(n[0]," — ").concat(n[1]))):(n[0]=flatpickr.formatDate(n[0],"j M Y"),r(n[0]))}else e=flatpickr.parseDate(e,"H:i d-m-y"),e=flatpickr.formatDate(e,"j M Y"),r("".concat(e," — ..."))}})},createPeriodSelector:function(t,e,n){var a=document.getElementById(t);a.parentNode.addEventListener("click",function(t){if(!t.target.classList.contains("flatpickr-input"))return!0;a.nextElementSibling.nextElementSibling.classList.toggle("active")}),a.parentNode.addEventListener("mouseout",function(t){for(var e=t.relatedTarget;e&&e.parentElement;){if("period-custom-selector-wrapper"==e.className)return!0;e=e.parentElement}a.timout=setTimeout(function(){a.nextElementSibling.nextElementSibling.classList.remove("active")},200)}),a.parentNode.addEventListener("mouseenter",function(){clearTimeout(a.timout)});var o=Charts.loadData(n,e),i=Charts.addDateRangePicker(a,o);a.parentNode.previousElementSibling.addEventListener("click",function(t){var e=t.target;"LABEL"==e.tagName&&""===e.className&&(e.parentNode.parentNode.querySelector("label.active").classList.remove("active"),e.className="active",o(i,e.getAttribute("data-period")))}),o(i,Charts._period)},loadData:function(c,t){return function(i,r,s){getJSON(t,{period:r,offset:(new Date).getTimezoneOffset()},function(t){if(!t.error)if(c(t,r),s)i.element.parentNode.parentNode.querySelector("label.active").classList.remove("active"),i.element.classList.add("active");else{var e=flatpickr.parseDate(new Date(1e3*t.series[0]),"H:i d-m-y"),n=flatpickr.formatDate(e,"j M Y");if("today"!==r&&"yesterday"!==r){var a=flatpickr.parseDate(new Date(1e3*t.series[t.series.length-1]),"H:i d-m-y"),o=flatpickr.formatDate(a,"j M Y");i.element.firstElementChild.nextSibling.textContent="".concat(n," — ").concat(o),i.setDate([e,a],!1)}else i.element.firstElementChild.nextSibling.textContent=n,i.setDate([e,e],!1)}})}}};!function(h){function g(t){return t.split("").reverse().join("")}function t(t){var e=t.elem;e.nodeType&&e.parentNode&&((e=e._animateNumberSetter)||(e=c.numberStep),e(t.now,t))}var c={numberStep:function(t,e){var n=Math.floor(t);h(e.elem).text(n)}};h.Tween&&h.Tween.propHooks?h.Tween.propHooks.number={set:t}:h.fx.step.number=t,h.animateNumber={numberStepFactories:{append:function(a){return function(t,e){var n=Math.floor(t);h(e.elem).prop("number",t).text(n+a)}},separator:function(f,p,v){return f=f||" ",p=p||3,v=v||"",function(t,e){var n=t<0,a=Math.floor((n?-1:1)*t).toString(),o=h(e.elem);if(a.length>p){for(var i,r,s,c=a,l=p,d=c.split("").reverse(),u=(a=[],0),m=Math.ceil(c.length/l);u<m;u++){for(i="",s=0;s<l&&(r=u*l+s)!==c.length;s++)i+=d[r];a.push(i)}c=a.length-1,l=g(a[c]),a[c]=g(parseInt(l,10).toString()),a=a.join(f),a=g(a)}o.prop("number",t).text((n?"-":"")+a+v)}}}},h.fn.animateNumber=function(){for(var t=arguments[0],e=h.extend({},c,t),n=h(this),a=[e],o=1,i=arguments.length;o<i;o++)a.push(arguments[o]);if(t.numberStep){var r=this.each(function(){this._animateNumberSetter=t.numberStep}),s=e.complete;e.complete=function(){r.each(function(){delete this._animateNumberSetter}),s&&s.apply(this,arguments)}}return n.animate.apply(n,a)}}(jQuery),function(e,n){"function"==typeof define&&define.amd?define(["jquery"],function(t){return n(e,t)}):"object"===("undefined"==typeof exports?"undefined":_typeof(exports))?n(e,require("jquery")):n(e,e.jQuery||e.Zepto)}(window,function(t,r){var e,a,n,s="remodal",c=t.REMODAL_GLOBALS&&t.REMODAL_GLOBALS.NAMESPACE||s,l=r.map(["animationstart","webkitAnimationStart","MSAnimationStart","oAnimationStart"],function(t){return"".concat(t,".").concat(c)}).join(" "),d=r.map(["animationend","webkitAnimationEnd","MSAnimationEnd","oAnimationEnd"],function(t){return"".concat(t,".").concat(c)}).join(" "),u=r.extend({hashTracking:!0,closeOnConfirm:!0,closeOnCancel:!0,closeOnEscape:!0,closeOnOutsideClick:!0,modifier:"",appendTo:null},t.REMODAL_GLOBALS&&t.REMODAL_GLOBALS.DEFAULTS),m={CLOSING:"closing",CLOSED:"closed",OPENING:"opening",OPENED:"opened"},f=void 0!==(e=document.createElement("div").style).animationName||void 0!==e.WebkitAnimationName||void 0!==e.MozAnimationName||void 0!==e.msAnimationName||void 0!==e.OAnimationName,o=/iPad|iPhone|iPod/.test(navigator.platform);function p(t){if(f&&"none"===t.css("animation-name")&&"none"===t.css("-webkit-animation-name")&&"none"===t.css("-moz-animation-name")&&"none"===t.css("-o-animation-name")&&"none"===t.css("-ms-animation-name"))return 0;var e,n,a,o,i=t.css("animation-duration")||t.css("-webkit-animation-duration")||t.css("-moz-animation-duration")||t.css("-o-animation-duration")||t.css("-ms-animation-duration")||"0s",r=t.css("animation-delay")||t.css("-webkit-animation-delay")||t.css("-moz-animation-delay")||t.css("-o-animation-delay")||t.css("-ms-animation-delay")||"0s",s=t.css("animation-iteration-count")||t.css("-webkit-animation-iteration-count")||t.css("-moz-animation-iteration-count")||t.css("-o-animation-iteration-count")||t.css("-ms-animation-iteration-count")||"1";for(i=i.split(", "),r=r.split(", "),s=s.split(", "),o=0,n=i.length,e=Number.NEGATIVE_INFINITY;o<n;o++)e<(a=parseFloat(i[o])*parseInt(s[o],10)+parseFloat(r[o]))&&(e=a);return e}function i(){if(r(document).height()<=r(window).height())return 0;var t,e,n=document.createElement("div"),a=document.createElement("div");return n.style.visibility="hidden",n.style.width="100px",document.body.appendChild(n),t=n.offsetWidth,n.style.overflow="scroll",a.style.width="100%",n.appendChild(a),e=a.offsetWidth,n.parentNode.removeChild(n),t-e}function v(){if(!o){var t,e=b("is-locked");if(document.documentElement.classList.contains(e)){var n=r(document.body);t=parseInt(n.css("padding-right"),10)-i(),n.css("padding-right","".concat(t,"px")),document.documentElement.classList.remove(e)}}}function h(t,e,n,a){var o=b("is",e),i=[b("is",m.CLOSING),b("is",m.OPENING),b("is",m.CLOSED),b("is",m.OPENED)].join(" ");t.$bg.removeClass(i).addClass(o),t.$overlay.removeClass(i).addClass(o),t.$wrapper.removeClass(i).addClass(o),t.$modal.removeClass(i).addClass(o),t.state=e,n||t.$modal.trigger({type:e,reason:a},[{reason:a}])}function g(t,e,n){function a(t){t.target===this&&i++}function o(t){t.target===this&&0==--i&&(r.each(["$bg","$overlay","$wrapper","$modal"],function(t,e){n[e].off("".concat(l," ").concat(d))}),e())}var i=0;r.each(["$bg","$overlay","$wrapper","$modal"],function(t,e){n[e].on(l,a).on(d,o)}),t(),0===p(n.$bg)&&0===p(n.$overlay)&&0===p(n.$wrapper)&&0===p(n.$modal)&&(r.each(["$bg","$overlay","$wrapper","$modal"],function(t,e){n[e].off("".concat(l," ").concat(d))}),e())}function y(n){n.state!==m.CLOSED&&(r.each(["$bg","$overlay","$wrapper","$modal"],function(t,e){n[e].off("".concat(l," ").concat(d))}),n.$bg.removeClass(n.settings.modifier),n.$overlay.removeClass(n.settings.modifier).hide(),n.$wrapper.hide(),v(),h(n,m.CLOSED,!0))}function b(){return"".concat(c,"-").concat(Array.prototype.slice.call(arguments).join("-"))}function E(){var t,e,n=location.hash.replace("#","");if(n){try{e=r("[data-".concat(s,'-id="').concat(n,'"]'))}catch(t){}e&&e.length&&(t=r[s].lookup[e.data(s)])&&t.settings.hashTracking&&t.open()}else a&&a.state===m.OPENED&&a.settings.hashTracking&&a.close()}function L(t,e){var n=r(document.body),a=this;a.settings=r.extend({},u,e),a.index=r[s].lookup.push(a)-1,a.state=m.CLOSED,a.$overlay=r(".".concat(b("overlay")));var o=t.parent();if(!a.$overlay.length){var i=document.createElement("div");i.className="".concat(b("overlay")," ").concat(b("is",m.CLOSED)),i.style.display="none",a.$overlay=r(i),n.append(a.$overlay)}a.$bg=r(".".concat(b("bg"))).addClass(b("is",m.CLOSED)),a.$modal=t.addClass("".concat(c," ").concat(b("is-initialized")," ").concat(a.settings.modifier," ").concat(b("is",m.CLOSED))).attr("tabindex","-1"),a.$wrapper=r("<div>").addClass("".concat(b("wrapper")," ").concat(a.settings.modifier," ").concat(b("is",m.CLOSED))).hide().append(a.$modal),o.append(a.$wrapper),a.$wrapper.on("click.".concat(c),"[data-".concat(s,'-action="close"]'),function(t){t.preventDefault(),a.close()}),a.$wrapper.on("click.".concat(c),function(t){t.target.classList.contains(b("wrapper"))&&a.settings.closeOnOutsideClick&&a.close()})}L.prototype.open=function(){var t,e=this;e.state!==m.OPENING&&e.state!==m.CLOSING&&((t=e.$modal.attr("data-".concat(s,"-id")))&&e.settings.hashTracking&&(n=r(window).scrollTop(),location.hash=t),a&&a!==e&&y(a),a=e,function(){if(!o){var t,e=b("is-locked");if(!document.documentElement.classList.contains(e)){var n=r(document.body);t=parseInt(n.css("padding-right"),10)+i(),n.css("padding-right","".concat(t,"px")),document.documentElement.classList.add(e)}}}(),e.$overlay.show(),e.$wrapper.show().scrollTop(0),e.$modal.focus(),g(function(){h(e,m.OPENING)},function(){h(e,m.OPENED)},e))},L.prototype.close=function(t){var e=this;e.state!==m.OPENING&&e.state!==m.CLOSING&&e.state!==m.CLOSED&&(e.settings.hashTracking&&e.$modal.attr("data-".concat(s,"-id"))===location.hash.substr(1)&&(location.hash="",r(window).scrollTop(n)),g(function(){h(e,m.CLOSING,!1,t)},function(){e.$bg.removeClass(e.settings.modifier),e.$overlay.removeClass(e.settings.modifier).hide(),e.$wrapper.hide(),v(),h(e,m.CLOSED,!1,t)},e))},L.prototype.getState=function(){return this.state},L.prototype.destroy=function(){var t=r[s].lookup;y(this),this.$wrapper.remove(),delete t[this.index],0===r.grep(t,function(t){return!!t}).length&&(this.$overlay.remove(),this.$bg.removeClass("".concat(b("is",m.CLOSING)," ").concat(b("is",m.OPENING)," ").concat(b("is",m.CLOSED)," ").concat(b("is",m.OPENED))))},r[s]={lookup:[]},r.fn[s]=function(n){var a;return this.each(function(t,e){null==e.getAttribute("data-".concat(s))?(a=new L(r(e),n),e.setAttribute("data-".concat(s),a.index),a.settings.hashTracking&&e.getAttribute("data-".concat(s,"-id"))===location.hash.substr(1)&&a.open()):a=r[s].lookup[e.getAttribute("data-".concat(s))]}),a},r(document).ready(function(){r(document).on("click","[data-".concat(s,"-target]"),function(t){t.preventDefault();var e=t.currentTarget.getAttribute("data-".concat(s,"-target")),n=r("[data-".concat(s,'-id="').concat(e,'"]'));r[s].lookup[n.data(s)].open()}),r(document).find(".".concat(c)).each(function(t,e){var n=r(e),a=n.data("".concat(s,"-options"));a?("string"==typeof a||a instanceof String)&&(a=function(t){var e,n,a,o,i={};for(o=0,n=(e=(t=t.replace(/\s*:\s*/g,":").replace(/\s*,\s*/g,",")).split(",")).length;o<n;o++)e[o]=e[o].split(":"),("string"==typeof(a=e[o][1])||a instanceof String)&&(a="true"===a||"false"!==a&&a),("string"==typeof a||a instanceof String)&&(a=isNaN(a)?a:+a),i[e[o][0]]=a;return i}(a)):a={},n[s](a)}),r(document).on("keydown.".concat(c),function(t){a&&a.settings.closeOnEscape&&a.state===m.OPENED&&27===t.keyCode&&a.close()}),r(window).on("hashchange.".concat(c),E)})});